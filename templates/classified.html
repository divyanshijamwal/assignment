{% extends "base.html" %}
{% block title %}Classified Transactions - Reconciliation{% endblock %}
{% block extra_css %}
<style>
    .page-title {
        font-weight: 700;
        color: #0f766e;
        margin-bottom: 0.5rem;
    }
    .badge-legend {
        display: flex;
        flex-wrap: wrap;
        gap: 0.75rem;
        margin-bottom: 1.5rem;
    }
    .badge-legend .badge {
        padding: 0.5rem 1rem;
        font-weight: 500;
        border-radius: 10px;
        font-size: 0.85rem;
    }
    .badge-5 { background: linear-gradient(135deg, #10b981 0%, #059669 100%); color: #fff; }
    .badge-6 { background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%); color: #fff; }
    .badge-7 { background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%); color: #fff; }
    .accordion-custom .accordion-item {
        border: 1px solid #e2e8f0;
        border-radius: 14px !important;
        margin-bottom: 0.75rem;
        overflow: hidden;
    }
    .accordion-custom .accordion-button {
        background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
        font-weight: 600;
        color: #1e293b;
        padding: 1rem 1.25rem;
        border: none;
        box-shadow: none !important;
    }
    .accordion-custom .accordion-button:not(.collapsed) {
        background: linear-gradient(135deg, #f0fdfa 0%, #ccfbf1 100%);
        color: #0f766e;
        border-bottom: 1px solid #e2e8f0;
    }
    .accordion-custom .accordion-button::after {
        background-size: 1.25rem;
    }
    .accordion-custom .accordion-body {
        padding: 1.5rem;
        background: #fff;
    }
    .accordion-custom .section-label {
        font-weight: 600;
        color: #0d9488;
        margin-bottom: 0.75rem;
        font-size: 0.9rem;
    }
    .table-responsive-custom {
        max-height: 420px;
        overflow: auto;
        border-radius: 12px;
        border: 1px solid #e2e8f0;
    }
    .table-responsive-custom table {
        margin-bottom: 0;
    }
    .table-responsive-custom .table {
        --bs-table-bg: transparent;
    }
    .table-responsive-custom .table thead th {
        background: linear-gradient(135deg, #0d9488 0%, #0f766e 100%);
        color: #fff !important;
        font-weight: 600;
        font-size: 0.8rem;
        padding: 0.75rem 1rem;
        white-space: nowrap;
        position: sticky;
        top: 0;
        z-index: 1;
    }
    .table-responsive-custom .table tbody td {
        padding: 0.65rem 1rem;
        font-size: 0.85rem;
    }
    .table-responsive-custom .table tbody tr:nth-child(even) {
        background: #f8fafc;
    }
    .table-responsive-custom .table tbody tr:hover {
        background: #f0fdfa;
    }
    .btn-upload-new {
        background: linear-gradient(135deg, #0d9488 0%, #0f766e 100%);
        border: none;
        font-weight: 600;
        padding: 0.65rem 1.5rem;
        border-radius: 12px;
        transition: all 0.2s;
    }
    .btn-upload-new:hover {
        transform: translateY(-1px);
        box-shadow: 0 4px 14px rgba(13, 148, 136, 0.35);
    }
    @media (max-width: 768px) {
        .table-responsive-custom { max-height: 300px; }
    }
</style>
{% endblock %}
{% block content %}
<h3 class="page-title">Transactions Classified as 5, 6 & 7</h3>
<p class="text-muted mb-4">Reconciliation results grouped by match status</p>

<div class="badge-legend">
    <span class="badge badge-5">5 = {{ labels[5] }}</span>
    <span class="badge badge-6">6 = {{ labels[6] }}</span>
    <span class="badge badge-7">7 = {{ labels[7] }}</span>
</div>

<div class="accordion accordion-custom" id="accordionClass">
    <div class="accordion-item">
        <h2 class="accordion-header">
            <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#class5">
                <span class="badge badge-5 me-2">5</span> Present in Both (Statement & Settlement)
            </button>
        </h2>
        <div id="class5" class="accordion-collapse collapse show" data-bs-parent="#accordionClass">
            <div class="accordion-body">
                <div class="section-label">From Statement</div>
                <div class="table-responsive-custom mb-4">{{ stmt_5 | safe }}</div>
                <div class="section-label">From Settlement</div>
                <div class="table-responsive-custom">{{ sett_5 | safe }}</div>
            </div>
        </div>
    </div>
    <div class="accordion-item">
        <h2 class="accordion-header">
            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#class6">
                <span class="badge badge-6 me-2">6</span> Present in Settlement but NOT in Statement
            </button>
        </h2>
        <div id="class6" class="accordion-collapse collapse" data-bs-parent="#accordionClass">
            <div class="accordion-body">
                <p class="text-muted small mb-3">Classification 6 appears only in Settlement file.</p>
                <div class="section-label">From Settlement</div>
                <div class="table-responsive-custom">{{ sett_6 | safe }}</div>
            </div>
        </div>
    </div>
    <div class="accordion-item">
        <h2 class="accordion-header">
            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#class7">
                <span class="badge badge-7 me-2">7</span> Present in Statement but NOT in Settlement
            </button>
        </h2>
        <div id="class7" class="accordion-collapse collapse" data-bs-parent="#accordionClass">
            <div class="accordion-body">
                <p class="text-muted small mb-3">Classification 7 appears only in Statement file.</p>
                <div class="section-label">From Statement</div>
                <div class="table-responsive-custom">{{ stmt_7 | safe }}</div>
            </div>
        </div>
    </div>
</div>

<div class="mt-4">
    <a href="{{ url_for('index') }}" class="btn btn-primary btn-upload-new">Upload New Files</a>
</div>
{% endblock %}
